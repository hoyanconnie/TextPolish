# TextPolish - Gemini文本格式修复工具

> 专门解决Gemini AI回答复制到Word后格式混乱问题的Windows桌面工具

## 📋 版本信息

**当前版本**: v2.0.0  
**更新日期**: 2024年12月

### 🎉 v2.0.0 更新内容
- ✨ **全新HTML预览功能**：右侧实时显示格式化效果
- 🌓 **主题自适应**：支持亮色/暗色主题自动切换
- 🔧 **样式系统重构**：分离预览样式和复制样式
- 🎨 **界面美化**：使用QFluentWidgets原生组件
- 🐛 **Bug修复**：修复主题切换时预览不更新的问题
- 🏗️ **架构重构**：模块化设计，提升代码可维护性
- 🗂️ **项目结构优化**：分离核心逻辑、UI组件和工具模块

## 🚀 快速开始

### 方式1：直接使用（推荐）
双击运行 `dist\TextPolish.exe`，无需安装Python环境。

### 方式2：重新构建
双击运行 `build_windows.bat`，自动构建新的exe文件。

### 方式3：开发运行
```cmd
# 使用uv（推荐）
uv run python main.py

# 或使用pip
pip install pyperclip
python main.py
```

## ✨ 主要功能

### 基础文本处理
- 🔧 **删除特殊符号**：自动删除 ·、•、▲、■ 等Gemini输出符号
- 📝 **标点转换**：智能将英文标点转为中文标点（，。：！？等）
- 🎯 **格式优化**：清理多余空格和换行，保持文本紧凑
- 📋 **文本复制**：处理结果直接复制到剪贴板

### 格式化复制功能 ⭐
- 📄 **带格式复制**：支持将文本转换为HTML格式，直接粘贴到WPS/Word保持格式
- 🏷️ **智能标题识别**：自动识别并格式化不同级别的标题
- ⚙️ **自定义控制**：用户可选择需要格式化的标题级别
- 🎨 **专业排版**：符合公文写作规范的字体和格式设置
- 👁️ **实时预览**：右侧HTML预览，实时查看格式化效果
- 🌓 **主题适配**：预览支持亮色/暗色主题自动切换

## 🔧 处理效果示例

### 基础文本处理

**处理前：**
```
· Gemini AI是一个强大的工具, 它能够: 
• 生成文本
▲ 回答问题
■ 提供帮助
但是(复制到Word后), 格式会很混乱! 真的吗?
```

**处理后：**
```
Gemini AI是一个强大的工具，它能够：
生成文本
回答问题
提供帮助
但是（复制到Word后），格式会很混乱！真的吗？
```

### 格式化复制效果

**原始文本：**
```
第一章 项目背景

第一节 发展现状

一、基本情况

一是产业规模不断扩大。截至2024年底...

（一）政策支持。国家出台了相关政策...

技术创新能力：企业加大研发投入...
```

**格式化后（在WPS/Word中）：**
- **第一章 项目背景** ← 一级标题（方正小标宋，18pt，居中）
- **第一节 发展现状** ← 二级标题（方正黑体，16pt，居中）
- **一、基本情况** ← 二级标题（方正黑体，16pt，居中）
- **一是产业规模不断扩大。**截至2024年底... ← 特殊格式（楷体加粗+仿宋正文）
- **（一）政策支持。** ← 三级标题（方正楷体，16pt加粗，两端对齐）
- **技术创新能力：**企业加大研发投入... ← 特殊格式（楷体加粗+仿宋正文）

## 📁 文件说明

### 用户文件
- `dist/TextPolish.exe` - 可执行程序（推荐使用）
- `README.md` - 项目说明文档

### 开发文件
- `main.py` - 程序入口文件
- `src/textpolish/` - 模块化源码目录
  - `core/` - 核心功能模块（文本处理、HTML生成）
  - `ui/` - 用户界面模块
  - `utils/` - 工具模块（剪贴板、图标管理）
  - `config.py` - 配置常量
  - `app.py` - 应用程序类
- `pyproject.toml` - uv项目配置
- `TextPolish.spec` - PyInstaller构建配置

- `icon.ico` - 应用图标

## 📋 标题识别规则

> 本工具严格按照公文写作规范进行格式设置，确保输出文档符合正式文件标准。

### 一级标题 (H1)
- **格式规范**：
  - 字体：方正小标宋_GBK
  - 字号：小二号字 (18pt)
  - 对齐：居中
  - 段前段后：0磅
  - 行距：单倍行距
- **识别规则**：
  - `第一章`、`第二章`、`第三章` 等章节标题
  - `前言` 特殊标题
- **示例**：`第一章 项目背景`、`前言`

### 二级标题 (H2)
- **格式规范**：
  - 字体：方正黑体_GBK
  - 字号：三号字 (16pt)
  - 对齐：居中
  - 段前段后：0磅
  - 行距：单倍行距
- **识别规则**：
  - `第一节`、`第二节`、`第三节` 等节次标题
  - `一、`、`二、`、`三、` 等序号标题
- **示例**：`第一节 基本情况`、`一、发展现状`

### 三级标题 (H3)
- **格式规范**：
  - 字体：方正楷体_GBK
  - 字号：三号字 (16pt) 加粗
  - 对齐：两端对齐
  - 段前段后：0磅
  - 行距：单倍行距
- **识别规则**：
  - `（一）`、`（二）`、`（三）` 等括号序号
- **示例**：`（一）政策支持`、`（二）市场需求`

### 特殊格式正文
- **格式规范**：
  - 特殊部分：方正楷体_GBK，三号字加粗
  - 后续内容：方正仿宋_GBK，三号字
  - 对齐：两端对齐
  - 段前段后：0磅
  - 行距：单倍行距
- **识别规则**：
  - `一是...。` 开头到第一个句号为止
  - `二是...。` 开头到第一个句号为止  
  - `内容标题：` 冒号前的部分
- **示例**：`一是产业规模不断扩大。`截至2024年...、`技术创新能力：`企业加大研发...

### 正文格式
- **格式规范**：
  - 中文字体：方正仿宋_GBK
  - 西文字体：Times New Roman
  - 字号：三号字 (16pt)
  - 对齐：两端对齐
  - 首行缩进：2字符
  - 段前段后：0磅
  - 行距：单倍行距
- **适用**：所有不符合上述特殊格式的普通文本段落

## 💡 使用方法

### 基础文本处理
1. **启动程序**：双击 `TextPolish.exe`
2. **粘贴文本**：在左侧输入框粘贴Gemini回答的文本
3. **处理文本**：点击"处理文本"按钮
4. **查看预览**：右侧自动显示格式化预览效果
5. **文本复制**：点击"文本复制"按钮，复制纯文本结果

### 格式化复制（推荐）
1. **处理文本**：先进行基础文本处理
2. **预览效果**：右侧实时显示标题层级和格式效果
3. **选择级别**：勾选需要格式化的标题级别（默认全选）
   - ☑️ 一级标题：章节标题格式化
   - ☑️ 二级标题：节次标题格式化  
   - ☑️ 三级标题：条目标题格式化
4. **格式复制**：点击"格式复制"按钮
5. **粘贴使用**：直接粘贴到WPS/Word，保持完整格式

### 主题切换
- **切换主题**：使用应用内主题切换功能
- **自动适配**：预览效果自动适应亮色/暗色主题
- **实时更新**：切换主题后预览颜色立即更新

## ⚙️ 系统要求

- **Windows 7/8/10/11**（64位）
- **内存**：至少 100MB 可用内存
- **存储**：约 30MB 磁盘空间

## 🔨 开发构建

### 重新构建exe
```cmd
# 自动构建（推荐）
build_windows.bat

# 手动构建
uv sync --dev
uv run pyinstaller TextPolish.spec
```

### 开发环境
```cmd
# 安装依赖
uv sync

# 运行开发版
uv run python main.py
```

## 🆘 常见问题

**Q: exe文件被杀毒软件拦截？**  
A: PyInstaller打包程序的常见误报，请添加到白名单。

**Q: 程序无法启动？**  
A: 确保是64位Windows系统，尝试"以管理员身份运行"。

**Q: 格式化复制后字体显示不正确？**  
A: 确保目标文档（WPS/Word）中安装了方正字体系列，或使用系统默认字体替代。

**Q: 标题识别不准确？**  
A: 请检查文本格式是否符合识别规则，可通过标题级别选择框自定义控制。

**Q: 西文字符字体设置失效？**  
A: HTML中使用了mso字体属性，确保在Office软件中粘贴以获得最佳效果。

**Q: 处理效果不满意？**  
A: 程序专门针对Gemini AI输出格式优化，其他来源文本可能效果不同。

**Q: 预览显示和实际复制效果不一致？**  
A: 预览使用简化样式便于查看，实际复制使用WPS标准格式，功能设计如此。

**Q: 暗色模式下预览看不清？**  
A: 预览已支持主题自动适配，切换主题后会自动更新颜色方案。

## 🔧 技术说明

### 格式化复制原理
- **双重HTML生成**：分离预览和复制的HTML生成
  - 预览HTML：主题适配的简化样式，用于应用内显示
  - 复制HTML：严格的WPS/Word兼容格式，用于文档粘贴
- **字体设置**：使用mso字体属性实现中西文混排
  - 西文：`mso-ascii-font-family: 'Times New Roman'`
  - 中文：`mso-fareast-font-family: 方正仿宋_GBK`
- **剪贴板**：同时复制HTML和纯文本格式，确保兼容性

### 预览系统
- **实时预览**：使用QFluentWidgets的TextBrowser组件
- **主题适配**：监听主题切换事件，自动更新预览颜色
- **样式分离**：预览样式与复制样式完全独立

### 依赖库
- **PyQt6**：现代化GUI框架
- **qfluentwidgets**：Fluent Design界面组件
- **BeautifulSoup4**：HTML处理和解析
- **pyperclip**：跨平台剪贴板操作

### 开发架构 (v2.0 模块化重构)

#### 📁 项目结构
```
TextPolish/
├── main.py                      # 程序入口
├── src/
│   └── textpolish/
│       ├── __init__.py          # 包初始化
│       ├── config.py            # 配置常量
│       ├── app.py               # 应用程序类
│       ├── core/                # 核心功能模块
│       │   ├── text_processor.py   # 文本处理器
│       │   └── html_generator.py   # HTML生成器
│       ├── ui/                  # 用户界面模块
│       │   ├── main_window.py      # 主窗口
│       │   └── main_interface.py   # 主界面组件
│       └── utils/               # 工具模块
│           ├── clipboard.py        # 剪贴板管理
│           └── icon.py             # 图标管理
├── icon.ico / icon.png          # 应用图标
├── pyproject.toml               # uv项目配置
├── TextPolish.spec              # PyInstaller配置

```

#### 🏗️ 架构说明
- **模块化设计**：按功能分离核心逻辑、UI组件和工具类
- **配置统一**：所有常量和配置集中在config.py中管理
- **职责分离**：文本处理、HTML生成、界面展示各司其职
- **可扩展性**：新功能可以轻松添加到相应模块中
- **测试友好**：各模块独立，便于单元测试

#### 🔄 数据流程
```
用户输入文本
    ↓
TextProcessor.clean_text()      # 文本清理
    ↓
HTMLGenerator.convert_to_html() # HTML转换
    ↓
├── generate_preview_html()     # 预览HTML (主题适配)
└── generate_wps_html()         # 复制HTML (WPS兼容)
    ↓
ClipboardManager.copy_rich_text() # 剪贴板操作
```

## 📜 许可证

MIT License - 免费使用，无需商业授权。

---

**提示**：首次使用建议用少量文本测试效果，确认满意后再处理大量内容。
