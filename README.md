# TextPolish - Gemini文本格式修复工具

> 专门解决Gemini AI回答复制到Word后格式混乱问题的Windows桌面工具

## 🚀 快速开始

### 方式1：直接使用（推荐）
双击运行 `dist\TextPolish.exe`，无需安装Python环境。

### 方式2：重新构建
双击运行 `build_windows.bat`，自动构建新的exe文件。

### 方式3：开发运行
```cmd
# 使用uv（推荐）
uv run python main.py

# 或使用pip
pip install pyperclip
python main.py
```

## ✨ 主要功能

### 基础文本处理
- 🔧 **删除特殊符号**：自动删除 ·、•、▲、■ 等Gemini输出符号
- 📝 **标点转换**：智能将英文标点转为中文标点（，。：！？等）
- 🎯 **格式优化**：清理多余空格和换行，保持文本紧凑
- 📋 **文本复制**：处理结果直接复制到剪贴板

### 格式化复制功能 ⭐
- 📄 **带格式复制**：支持将文本转换为HTML格式，直接粘贴到WPS/Word保持格式
- 🏷️ **智能标题识别**：自动识别并格式化不同级别的标题
- ⚙️ **自定义控制**：用户可选择需要格式化的标题级别
- 🎨 **专业排版**：符合公文写作规范的字体和格式设置

## 🔧 处理效果示例

### 基础文本处理

**处理前：**
```
· Gemini AI是一个强大的工具, 它能够: 
• 生成文本
▲ 回答问题
■ 提供帮助
但是(复制到Word后), 格式会很混乱! 真的吗?
```

**处理后：**
```
Gemini AI是一个强大的工具，它能够：
生成文本
回答问题
提供帮助
但是（复制到Word后），格式会很混乱！真的吗？
```

### 格式化复制效果

**原始文本：**
```
第一章 项目背景

第一节 发展现状

一、基本情况

一是产业规模不断扩大。截至2024年底...

（一）政策支持。国家出台了相关政策...

技术创新能力：企业加大研发投入...
```

**格式化后（在WPS/Word中）：**
- **第一章 项目背景** ← 一级标题（方正小标宋，18pt，居中）
- **第一节 发展现状** ← 二级标题（方正黑体，16pt，居中）
- **一、基本情况** ← 二级标题（方正黑体，16pt，居中）
- **一是产业规模不断扩大。**截至2024年底... ← 特殊格式（楷体加粗+仿宋正文）
- **（一）政策支持。** ← 三级标题（方正楷体，16pt加粗，两端对齐）
- **技术创新能力：**企业加大研发投入... ← 特殊格式（楷体加粗+仿宋正文）

## 📁 文件说明

- `dist/TextPolish.exe` - 可执行程序（推荐使用）
- `main.py` - 程序源码
- `build_windows.bat` - exe构建脚本
- `pyproject.toml` - 项目配置（uv管理）
- `requirements.txt` - pip依赖列表

## 📋 标题识别规则

### 一级标题 (H1)
- **格式**：方正小标宋_GBK，小二号字(18pt)，居中对齐
- **识别规则**：
  - `第一章`、`第二章`、`第三章` 等
  - `前言`

### 二级标题 (H2)
- **格式**：方正黑体_GBK，三号字(16pt)，居中对齐
- **识别规则**：
  - `第一节`、`第二节`、`第三节` 等
  - `一、`、`二、`、`三、` 等

### 三级标题 (H3)
- **格式**：方正楷体_GBK，三号字(16pt)加粗，两端对齐
- **识别规则**：
  - `（一）`、`（二）`、`（三）` 等

### 特殊格式正文
- **格式**：段落内楷体加粗 + 正文仿宋体混排
- **识别规则**：
  - `一是...。` 开头到句号为止
  - `二是...。` 开头到句号为止
  - `文字内容：` 冒号前的部分

### 正文格式
- **中文字体**：方正仿宋_GBK，三号字(16pt)
- **西文字体**：Times New Roman，三号字(16pt)
- **格式**：首行缩进2字符，两端对齐

## 💡 使用方法

### 基础文本处理
1. **启动程序**：双击 `TextPolish.exe`
2. **粘贴文本**：在左侧输入框粘贴Gemini回答的文本
3. **处理文本**：点击"处理文本"按钮
4. **文本复制**：点击"文本复制"按钮，复制纯文本结果

### 格式化复制
1. **处理文本**：先进行基础文本处理
2. **选择级别**：勾选需要格式化的标题级别（默认全选）
   - ☑️ 一级标题：章节标题格式化
   - ☑️ 二级标题：节次标题格式化  
   - ☑️ 三级标题：条目标题格式化
3. **格式复制**：点击"格式复制"按钮
4. **粘贴使用**：直接粘贴到WPS/Word，保持完整格式

## ⚙️ 系统要求

- **Windows 7/8/10/11**（64位）
- **内存**：至少 100MB 可用内存
- **存储**：约 30MB 磁盘空间

## 🔨 开发构建

### 重新构建exe
```cmd
# 自动构建（推荐）
build_windows.bat

# 手动构建
uv sync --dev
uv run pyinstaller TextPolish.spec
```

### 开发环境
```cmd
# 安装依赖
uv sync

# 运行开发版
uv run python main.py
```

## 🆘 常见问题

**Q: exe文件被杀毒软件拦截？**  
A: PyInstaller打包程序的常见误报，请添加到白名单。

**Q: 程序无法启动？**  
A: 确保是64位Windows系统，尝试"以管理员身份运行"。

**Q: 格式化复制后字体显示不正确？**  
A: 确保目标文档（WPS/Word）中安装了方正字体系列，或使用系统默认字体替代。

**Q: 标题识别不准确？**  
A: 请检查文本格式是否符合识别规则，可通过标题级别选择框自定义控制。

**Q: 西文字符字体设置失效？**  
A: HTML中使用了mso字体属性，确保在Office软件中粘贴以获得最佳效果。

**Q: 处理效果不满意？**  
A: 程序专门针对Gemini AI输出格式优化，其他来源文本可能效果不同。

## 🔧 技术说明

### 格式化复制原理
- **HTML生成**：基于Microsoft Office HTML标准生成兼容文档
- **字体设置**：使用mso字体属性实现中西文混排
  - 西文：`mso-ascii-font-family: 'Times New Roman'`
  - 中文：`mso-fareast-font-family: 方正仿宋_GBK`
- **剪贴板**：同时复制HTML和纯文本格式，确保兼容性

### 依赖库
- **PyQt6**：现代化GUI框架
- **qfluentwidgets**：Fluent Design界面组件
- **BeautifulSoup4**：HTML处理和解析
- **pyperclip**：跨平台剪贴板操作

### 开发架构
```
TextPolishWindow (主窗口)
└── TextPolishInterface (核心界面)
    ├── 文本处理 (clean_text)
    ├── HTML转换 (convert_to_html)
    ├── 标题识别 (正则表达式匹配)
    └── 剪贴板操作 (write_to_clipboard)
```

## 📜 许可证

MIT License - 免费使用，无需商业授权。

---

**提示**：首次使用建议用少量文本测试效果，确认满意后再处理大量内容。
